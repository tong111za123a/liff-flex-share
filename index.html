<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üñ§‚û£‡ªÇ„ÅÆ·Äî·Äê’É‡∏±‡πà’Å¬π‚úØüñ§</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body {
  font-family: sans-serif;
  margin:0;
  padding:0;
  height:100vh;
  background: url('https://i.postimg.cc/j5Gkxs3K/IMG-1275.gif') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:auto;
  backdrop-filter:brightness(0.6);
}

/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
.panel {
  width:92%;
  max-width:360px;
  background:rgba(0,0,0,0.75);
  padding:12px 15px;
  border-radius:10px;
  margin-top:15px;
  font-size:14px;
}

input {
  width:95%;
  padding:10px;
  border-radius:5px;
  border:none;
  font-size:14px;
  margin-top:6px;
  background:#222;
  color:#fff;
}

button {
  font-size:15px;
  padding:8px 18px;
  border-radius:5px;
  border:1px solid #0ff;
  background:#000;
  color:#0ff;
  margin-top:10px;
}

button:hover {
  background:#0ff;
  color:#000;
}

.qr { margin-top:20px; }
.qr img { width:150px; border-radius:8px; border:2px solid #0ff; }
.qr p { font-size:13px; color:#0ff; font-weight:bold; }
#myUserId { margin-top:8px; font-size:13px; color:#0f0; font-weight:bold; }
#noAccessPanel { display:none; }
</style>
</head>

<body>

<h3 id="greeting" style="margin-top:15px;">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì...</h3>

<div class="panel" style="text-align:center;">
  <button onclick="contactCreator()">‚ûï‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡∏Ñ‡∏•‡∏¥‡∏Å!)</button>
</div>

<div class="panel">
  <p style="margin-bottom: 5px; color: #0ff;">‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏≠‡∏î‡∏µ‡πÑ‡∏•‡∏ô‡πå</p>
  <input id="genInput" placeholder="URL‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡πÑ‡∏≠‡∏î‡∏µ‡πÑ‡∏•‡∏ô‡πå" />
  <button onclick="sendFlex()">‡πÅ‡∏ä‡∏£‡πå Flex</button>
  <button onclick="window.location.href='https://pic.in.th/?lang=th'" style="border-color: #ff00ff; color: #ff00ff; margin-left: 5px;">‡∏ù‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
</div>

<div class="panel">
  <button onclick="checkUserId()">üîç Check UserId</button>
  <div id="myUserId"></div>
</div>

<div class="panel" id="noAccessPanel">
  <h4>‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ä‡∏£‡πå Flex</h4>
  <button onclick="contactCreator()">‚ûï ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å!)</button>
</div>

<div class="qr">
  <img src="https://img5.pic.in.th/file/secure-sv1/IMG_12468d6ce5b9565e3489.jpeg"/>
  <p>‡πÅ‡∏™‡∏Å‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á</p>
</div>

<script>
const ADMIN = "Ua48c35a3cd7641afee1d85c317032ad5";

// whitelist (‡πÉ‡∏™‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
let whitelist = [
  {name:"‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö", userId:ADMIN},
  {name:"‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏ó‡∏™‡∏£‡∏∞‡∏ö‡∏ö", userId:"U9b6952e52b4a9a683471ae688bf30b80"},
  {name:"‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ P", userId:"Uffa99b9ba90b2d097eb5300c6a521560"}
];

let currentUserId = "";

// ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ userId
async function checkUserId(){
  if(!liff.isLoggedIn()) liff.login();
  const profile = await liff.getProfile();
  currentUserId = profile.userId;
  document.getElementById("myUserId").innerText = `"${profile.displayName}","${currentUserId}"`;
}

// ‡∏™‡πà‡∏á Flex
async function sendFlex(){
  if(!liff.isInClient()) return alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");
  try{
    const profile = await liff.getProfile();
    currentUserId = profile.userId;

    const allowed = whitelist.some(w => w.userId === currentUserId);
    if(!allowed){
      document.getElementById("noAccessPanel").style.display="block";
      return alert("‚õî ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ä‡∏£‡πå Flex");
    }

    const raw = document.getElementById("genInput").value.trim();
    const parts = raw.split(" ");
    if(parts.length < 2) return alert("‚ùå format ‡∏ú‡∏¥‡∏î");

    const [imageUrl, lineId] = parts;

    const flexMsg = {
      "type": "flex",
      "altText": "FLEX ‡∏™‡∏ô‡πÉ‡∏à‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ID: mc357.com",
      "contents": {
        "type": "carousel",
        "contents": [
          {
            "type": "bubble",
            "size": "giga",
            "hero": {
              "type": "image",
              "url": imageUrl,
              "size": "full",
              "aspectMode": "cover",
              "aspectRatio": "2:3",
              "gravity": "top"
            },
            "action": {
              "type": "uri",
              "uri": "https://line.me/ti/p/~" + lineId
            }
          }
        ]
      }
    };

    await liff.shareTargetPicker([flexMsg]);
    alert("‚ú® ‡πÅ‡∏ä‡∏£‡πå Flex ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  }catch(e){
    alert("‚ùå Flex error: " + e);
  }
}

// ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á
function contactCreator(){
  window.location.href = "http://line.me/ti/p/~mc357.com";
}

// LIFF init + ‡∏ó‡∏±‡∏Å‡∏ä‡∏∑‡πà‡∏≠
liff.init({ liffId: "2008621627-1eN2VA2x" }).then(async ()=>{
  if(!liff.isLoggedIn()) liff.login();
  const profile = await liff.getProfile();
  document.getElementById("greeting").innerText = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì " + profile.displayName;
});
</script>

</body>
</html>