<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LIFF Flex Generator</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body {
  font-family: sans-serif;
  margin:0;
  padding:0;
  height:100vh;
  background: url('https://img2.pic.in.th/IMG_1247.gif') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:auto;
  backdrop-filter:brightness(0.6);
}
.panel {
  width:90%;
  background:rgba(0,0,0,0.7);
  padding:16px;
  border-radius:10px;
  margin-top:20px;
  text-align:left;
}
input {
  width:100%;
  padding:12px;
  border-radius:6px;
  border:none;
  font-size:16px;
  margin-top:8px;
  background:#111;
  color:#0ff;
}
button {
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:6px;
  border:1px solid #0ff;
  background:#000;
  color:#0ff;
  font-size:18px;
  cursor:pointer;
}
button:hover {
  background:#0ff;
  color:#000;
}
#myUserId {
  margin-top:10px;
  font-weight:bold;
  color:#0f0;
  font-size:14px;
  word-break:break-all;
}
.qr {
  margin-top:30px;
}
.qr img {
  border-radius:10px;
  border:2px solid #0ff;
}
.qr p {
  color:#0ff;
  font-weight:bold;
}
</style>
</head>

<body>

<h2 id="greeting">สวัสดีคุณ...</h2>
<h4 style="color:#0ff;">ระบบพร้อมให้บริการ</h4>

<div class="panel">
  <h3>Flex Generator</h3>
  <input id="imageUrl" placeholder="ใส่ลิงก์รูปภาพ" />
  <input id="lineId" placeholder="LINE ID (เช่น mc357.com)" />
  <button onclick="sendFlex()">ส่ง Flex</button>
</div>

<div class="panel">
  <h3>เช็ก UserId</h3>
  <button onclick="showMyUserId()">ดู UserId ของฉัน</button>
  <div id="myUserId"></div>
</div>

<div class="panel" id="noAccessPanel" style="display:none; border:1px solid red; background:rgba(255,0,0,0.2);">
  <h3 style="color:red;">คุณไม่มีสิทธิ์ส่ง Flex</h3>
  <button onclick="goAddFriend()" style="color:#fff; border-color:#fff;">เพิ่มเพื่อน Admin</button>
</div>

<div class="panel">
  <h3>ระบบสิทธิ์การใช้งาน</h3>
  <p>เฉพาะผู้ใช้ที่ถูกเพิ่ม UserId เท่านั้นจึงจะส่ง Flex ได้</p>
  <p>Admin: Ua48c35a3cd7641afee1d85c317032ad5</p>
</div>

<div class="qr">
  <h3>แสกนเพื่อติดต่อผู้สร้าง</h3>
  <img src="https://img5.pic.in.th/file/secure-sv1/IMG_12468d6ce5b9565e3489.jpeg" width="220px"/>
  <p>แสกนเพื่อติดต่อผู้สร้าง</p>
</div>

<script>
const ADMIN = "Ua48c35a3cd7641afee1d85c317032ad5";

// ใส่ UserId สำคัญเท่านั้น
const whitelist = [
  { name: "Admin", userId: "Ua48c35a3cd7641afee1d85c317032ad5" },
  { name: "ระบบ1", userId: "U1111111111111111111111111111111" }
];

let currentUserId = "";

async function sendFlex(){
  if(!liff.isInClient()) return alert("กรุณาเปิดผ่าน LINE");
  if(!liff.isLoggedIn()) return liff.login();

  const profile = await liff.getProfile();
  currentUserId = profile.userId;

  const allowed = whitelist.some(w => w.userId === currentUserId);
  if(!allowed && currentUserId !== ADMIN){
    document.getElementById("noAccessPanel").style.display = "block";
    return alert("คุณไม่มีสิทธิ์ส่ง Flex");
  }

  const imageUrl = document.getElementById("imageUrl").value.trim();
  const lineId = document.getElementById("lineId").value.trim();
  if(!imageUrl || !lineId) return alert("ใส่ข้อมูลให้ครบ");

  const flexMsg = {
    type: "flex",
    altText: "FLEX ฟรี สนใจติดต่อ ID: mc357.com",
    contents: {
      type: "bubble",
      hero: {
        type: "image",
        url: imageUrl,
        size: "full",
        aspectRatio: "2:3",
        aspectMode: "cover",
        action: { type: "uri", uri: "https://line.me/ti/p/~" + lineId }
      },
      body: {
        type: "box",
        layout: "vertical",
        contents: [
          { type: "text", text: "FLEX ฟรี", weight: "bold", size: "xl", color: "#0ff" },
          { type: "text", text: "สนใจติดต่อ ID: mc357.com", size: "md", margin: "md", color: "#fff" }
        ]
      },
      footer: {
        type: "box",
        layout: "vertical",
        contents: [
          {
            type: "button",
            style: "primary",
            label: "ติดต่อผู้สร้าง",
            action: { type: "uri", uri: "https://line.me/ti/p/~mc357.com" }
          }
        ],
        backgroundColor: "#000"
      }
    }
  };

  await liff.shareTargetPicker([flexMsg]);
  alert("ส่ง Flex สำเร็จ!");
}

async function showMyUserId(){
  const profile = await liff.getProfile();
  document.getElementById("myUserId").innerText = profile.userId;
}

function goAddFriend(){
  window.location.href = "https://line.me/ti/p/~mc357.com";
}

liff.init({ liffId: "2008621627-1eN2VA2x" }).then(async ()=>{
  const profile = await liff.getProfile();
  currentUserId = profile.userId;
  document.getElementById("greeting").innerText = "สวัสดีคุณ " + profile.displayName;
});
</script>

</body>
</html>